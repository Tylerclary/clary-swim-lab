<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clary Swim Lab</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header-grid">
  <div class="header-left">
    <img src="clary-swim-lab-logo.png" alt="Clary Swim Lab Logo" class="logo-img" />
    
  </div>
  <div class="header-right">
    <p class="tagline"><strong>Expert Stroke Analysis from an Olympic Gold Medalist</strong></p>
    <p>
      Submit your swim video and receive a detailed, personalized analysis from Olympic gold medalist Tyler Clary.
      Each breakdown includes voiceover commentary, visual cues, and a follow-up email with drills and takeaways.
    </p>
  </div>
</header>

  <main>

    <section class="upload">
      <h2>Submit Your Video</h2>
      <p>We accept .mp4, .mov, or .avi up to 500MB.</p>
      <form id="upload-form">
  			<input type="file" name="video" accept="video/*" required />
  				<input type="text" name="first-name" placeholder="First Name" required />
  				<input type="text" name="last-name" placeholder="Last Name" required />
  				<input type="text" name="email" placeholder="Your Email" required />
  				<button type="submit">Upload for Analysis</button>
			</form>
			<p id="upload-status"></p>
      <p>After upload, your video will be verified and you will receive an invoice. Analysis begins upon receipt of payment.</p>
    </section>

    <section class="services">
      <h2>What Youâ€™ll Receive</h2>
      <ul>
        <li>Detailed video breakdown by Tyler Clary</li>
        <li>Voiceover commentary on your stroke technique</li>
        <li>Email summary with recommended drills and key focus areas</li>
        <li>Encouraging insights based on over 15 years of elite coaching experience</li>
      </ul>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 Clary Swim Lab. All rights reserved.</p>
    <p><a href="mailto:tylerclaryusa@gmail.com">tylerclaryusa@gmail.com</a></p>
  </footer>
  <form id="upload-form">
  <input type="file" name="video" accept="video/*" required />
  <input type="text" name="first-name" placeholder="First Name" required />
  <input type="text" name="last-name" placeholder="Last Name" required />
  <input type="email" name="email" placeholder="Your Email" required />
  <button type="submit">Upload for Analysis</button>
</form>
<p id="upload-status"></p>

<script>
document.getElementById("upload-form").addEventListener("submit", async function (e) {
  e.preventDefault();

  const fileInput = document.querySelector('input[name="video"]');
  const firstName = document.querySelector('input[name="first-name"]').value;
  const lastName = document.querySelector('input[name="last-name"]').value;
  const email = document.querySelector('input[name="email"]').value;

  const file = fileInput.files[0];
  if (!file) return alert("Please select a file.");

  // Step 1: Request a presigned POST URL from your backend
  const response = await fetch("https://xe1yx93vwa.execute-api.us-east-2.amazonaws.com", {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify({ filename: file.name })
  });

  const data = await response.json();
  const formData = new FormData();

  // Step 2: Append all S3 POST fields from the response
  Object.entries(data.fields).forEach(([key, value]) => {
    formData.append(key, value);
  });

  // Step 3: Append the actual file
  formData.append("file", file);

  // Step 4: Upload directly to S3
  const uploadStatus = document.getElementById("upload-status");
  uploadStatus.textContent = "Uploading...";

  const s3Upload = await fetch(data.url, {
    method: "POST",
    body: formData
  });

  if (s3Upload.ok) {
    uploadStatus.textContent = "Upload successful! You'll receive an email once your analysis is ready.";
  } else {
    uploadStatus.textContent = "Upload failed. Please try again.";
  }
});
</script>
</body>
</html>
